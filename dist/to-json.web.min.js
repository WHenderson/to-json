!function(t,n){"function"==typeof define&&define.amd?define([],n):t.toJson=n()}(this,function(){var t,n,o,e,r,a,s={}.hasOwnProperty,i=function(t,n){function o(){this.constructor=t}for(var e in n)s.call(n,e)&&(t[e]=n[e]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},u=[].slice;return t=function(){function t(n,o){return this.data=n,this instanceof t?void(null!=o&&(this.dataKey=o.dataKey,this.jsonKey=o.jsonKey,this.parentContext=o.parentContext)):new t(this.data,o).apply()}return t.prototype.childContextClass=t,t.prototype.apply=function(t){return this._exclude()?void 0:(this._convertData(),this._excludeData()?void 0:(this._toJson(t),this._excludeJson()?void 0:this.json))},t.prototype._toJson=function(t){var n,o;t||null==(null!=(n=this.data)?n.toJsonContext:void 0)||"function"!=typeof this.data.toJsonContext?this.json=t||null==(null!=(o=this.data)?o.toJSON:void 0)||"function"!=typeof this.data.toJSON?this._getEnumerator()(this._toJsonNamed.bind(this)):this.data.toJSON():this.data.toJsonContext(this).apply(!0)},t.prototype._getEnumeratorArray=function(){return function(t){return function(n){var o,e,r,a,s;for(t.json=[],s=t.data,r=e=0,a=s.length;a>e;r=++e)o=s[r],n(o,r,t._getJsonIndex(r));return t.json}}(this)},t.prototype._getEnumeratorObject=function(){return function(t){return function(n){var o,e,r;t.json={},e=t.data;for(o in e)s.call(e,o)&&(r=e[o],n(r,o,t._getJsonKey(o)));return t.json}}(this)},t.prototype._getEnumeratorValue=function(){return function(t){return function(){return t.json=t.data,t.json}}(this)},t.prototype._getEnumerator=function(){return Array.isArray(this.data)?this._getEnumeratorArray():"object"==typeof this.data&&null!==this.data?this._getEnumeratorObject():this._getEnumeratorValue()},t.prototype._toJsonNamed=function(t,n,o){var e,r;return e=this._createChildContext(t,n,o),r=e.apply(),void 0!==r&&(this.json[o]=r),e},t.prototype._createChildContext=function(t,n,o){return new this.childContextClass(t,{dataKey:n,jsonKey:o,parentContext:this})},t.prototype.adjustContext=function(t,n){var o,e;for(o in t)s.call(t,o)&&(e=t[o],this[o]=e);return n&&this.adjustChildContexts(t,n),this},t.prototype.adjustChildContexts=function(t,n){var o,e;this.childContextClass=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return i(n,t),n}(this.childContextClass);for(o in t)s.call(t,o)&&(e=t[o],this.childContextClass.prototype[o]=e);return n&&(this.childContextClass.prototype.childContextClass=this.childContextClass),this},t.prototype._super=function(t){var n,o;for(o=this[t],n=this.constructor;null!=n&&n.prototype[t]===o;)n=n.__super__.constructor;return n.prototype[t]},t.prototype._callSuper=function(){var t,n;return n=arguments[0],t=2<=arguments.length?u.call(arguments,1):[],this._super(n).apply(this,t)},t.prototype._getJsonKey=function(t){return t},t.prototype._getJsonIndex=function(t){return this.json.length},t.prototype._exclude=function(){return!1},t.prototype._convertData=function(){},t.prototype._excludeData=function(){return!1},t.prototype._excludeJson=function(){return!1},t.prototype.dataPath=function(){var t,n;for(n=[],t=this;null!=t;)null!=t.dataKey&&n.unshift(t.dataKey),t=t.parentContext;return n},t.prototype.jsonPath=function(){var t,n;for(n=[],t=this;null!=t;)null!=t.jsonKey&&n.unshift(t.jsonKey),t=t.parentContext;return n},t}(),e=function(t){function n(t,o){var e,r;n.__super__.constructor.call(this,t,o),this.pathMap=null!=(e=null!=(r=this.parentContext)?r.pathMap:void 0)?e:{}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.pathMap[r.jsonPath().join("/")]=r.dataPath().join("/")),r},n}(t),t.WithPathMap=e,a=function(t){var n;for(n in t)if(s.call(t,n))return!1;return!0},r=function(t){function n(t,o){n.__super__.constructor.call(this,t,o),this.pathTree={}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.pathTree[r.jsonKey]=a(r.pathTree)?{id:r.dataKey}:{id:r.dataKey,children:r.pathTree})},n}(t),t.WithPathTree=r,n=function(t){function n(t,o){var e,r;n.__super__.constructor.call(this,t,o),this.dataMap=null!=(e=null!=(r=this.parentContext)?r.dataMap:void 0)?e:{}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.dataMap[r.jsonPath().join("/")]={dataPath:r.dataPath().join("/"),data:t,convertedData:r.data,json:this.json[e]}),r},n}(t),t.WithDataMap=n,o=function(t){function n(t,o){n.__super__.constructor.call(this,t,o),this.dataTree={}}return i(n,t),n.prototype.childContextClass=n,n.prototype._toJsonNamed=function(t,o,e){var r;return r=n.__super__._toJsonNamed.call(this,t,o,e),void 0!==this.json[e]&&(this.dataTree[r.jsonKey]={id:r.dataKey,data:t,convertedData:r.data,json:this.json[e]},a(r.dataTree)||(this.dataTree[r.jsonKey].children=r.dataTree)),r},n}(t),t.WithDataTree=o,t});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvLWpzb24uY29mZmVlIiwidG8tanNvbi53ZWIuanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJ0b0pzb24iLCJ0aGlzIiwiVG9Kc29uIiwiVG9Kc29uV2l0aERhdGFNYXAiLCJUb0pzb25XaXRoRGF0YVRyZWUiLCJUb0pzb25XaXRoUGF0aE1hcCIsIlRvSnNvbldpdGhQYXRoVHJlZSIsImlzRW1wdHkiLCJoYXNQcm9wIiwiaGFzT3duUHJvcGVydHkiLCJleHRlbmQiLCJjaGlsZCIsInBhcmVudCIsImN0b3IiLCJjb25zdHJ1Y3RvciIsImtleSIsImNhbGwiLCJwcm90b3R5cGUiLCJfX3N1cGVyX18iLCJzbGljZSIsImRhdGExIiwib3B0aW9ucyIsImRhdGEiLCJkYXRhS2V5IiwianNvbktleSIsInBhcmVudENvbnRleHQiLCJhcHBseSIsImNoaWxkQ29udGV4dENsYXNzIiwiZXhjbHVkZUN1c3RvbVRvSnNvbiIsIl9leGNsdWRlIiwiX2NvbnZlcnREYXRhIiwiX2V4Y2x1ZGVEYXRhIiwiX3RvSnNvbiIsIl9leGNsdWRlSnNvbiIsImpzb24iLCJyZWYiLCJyZWYxIiwidG9Kc29uQ29udGV4dCIsInRvSlNPTiIsIl9nZXRFbnVtZXJhdG9yIiwiX3RvSnNvbk5hbWVkIiwiYmluZCIsIl9nZXRFbnVtZXJhdG9yQXJyYXkiLCJfdGhpcyIsImNiIiwiZWxlbWVudCIsImkiLCJpZWxlbWVudCIsImxlbiIsImxlbmd0aCIsIl9nZXRKc29uSW5kZXgiLCJfZ2V0RW51bWVyYXRvck9iamVjdCIsInZhbCIsIl9nZXRKc29uS2V5IiwiX2dldEVudW1lcmF0b3JWYWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsImNoaWxkQ29udGV4dCIsIl9jcmVhdGVDaGlsZENvbnRleHQiLCJhZGp1c3RDb250ZXh0Iiwib3ZlcnJpZGVzIiwic3RpY2t5IiwidmFsdWUiLCJhZGp1c3RDaGlsZENvbnRleHRzIiwic3VwZXJDbGFzcyIsIl9DbGFzcyIsImFyZ3VtZW50cyIsIl9zdXBlciIsIm5hbWUiLCJjbHMiLCJjdXJyZW50IiwiX2NhbGxTdXBlciIsImFyZ3MiLCJkYXRhSW5kZXgiLCJkYXRhUGF0aCIsIm5vZGUiLCJwYXRoIiwidW5zaGlmdCIsImpzb25QYXRoIiwicGF0aE1hcCIsImpvaW4iLCJXaXRoUGF0aE1hcCIsIm9iaiIsInBhdGhUcmVlIiwiaWQiLCJjaGlsZHJlbiIsIldpdGhQYXRoVHJlZSIsImRhdGFNYXAiLCJjb252ZXJ0ZWREYXRhIiwiV2l0aERhdGFNYXAiLCJkYXRhVHJlZSIsIldpdGhEYXRhVHJlZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FBQSxrQkFBQUMsU0FBQUEsT0FBQUMsSUNFSUQsVUFBV0QsR0FFWEQsRUFBS0ksT0FBU0gsS0RIbEJJLEtBQUEsV0NNQSxHRE5BQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQ09FQyxLRE5GQyxlQ09FQyxFRExGLFNBQUFDLEVBQUFDLEdBQUEsUUFBQUMsS0FBQVosS0FBQWEsWUFBQUgsRUFBQSxJQUFBLEdBQUFJLEtBQUFILEdBQUFKLEVBQUFRLEtBQUFKLEVBQUFHLEtBQUFKLEVBQUFJLEdBQUFILEVBQUFHLEdBQUEsT0FBQUYsR0FBQUksVUFBQUwsRUFBQUssVUFBQU4sRUFBQU0sVUFBQSxHQUFBSixHQUFBRixFQUFBTyxVQUFBTixFQUFBSyxVQUFBTixHQ01FUSxLRExGQSxLQ2lXQSxPQTFWQWpCLEdETEEsV0NNRSxRRFhGQSxHQUFBa0IsRUFBQUMsR0FRQSxNQ0lJcEIsTURaSnFCLEtBQUFGLEVBUUFuQixlQUFBQyxRQ01xQixNQUFYbUIsSURmVnBCLEtBQUFzQixRQUFBRixFQUFBRSxRQ2lCUXRCLEtBQUt1QixRQUFVSCxFQUFRRyxRQUN2QnZCLEtBQUt3QixjRFBiSixFQUFBSSxnQkFLQSxHQUFBdkIsR0FBQUQsS0FBQXFCLEtBQUFELEdBQUFLLFFBc0tBLE1DN0pFeEIsR0RGRmUsVUFBQVUsa0JBQUF6QixFQ0lFQSxFQUFPZSxVQUFVUyxNQUFRLFNB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RVExRCxLQUFNQSxFQUNOa0UsY0FBZS9CLEVBQWFuQyxLQUM1QlksS0FBTWpDLEtBQUtpQyxLQUFLVixLRDdEeEJpQyxHQ21FU3RELEdEakVURCxHQ3FFQUEsRURsRUF1RixZQUFBdEYsRUNvRUFDLEVBQXFCLFNBQVU0RCxHQUc3QixRQUFTNUQsR0FBbUJrQixFRG5FOUJELEdBQ0FqQixFQUFBYyxVQUFBSixZQUFBRSxLQUFBZixLQUFBcUIsRUFBQUQsR0FBQXBCLEtBQUF5RixZQzBGRSxNQTFCQWhGLEdBQU9OLEVBQW9CNEQsR0FPM0I1RCxFRG5FRmEsVUFBQVUsa0JBREF2QixFQ3NFRUEsRURuRUZhLFVBQUF1QixhQUhBLFNBQUFsQixFQUFBQyxFQUFBQyxHQ3VFSSxHRG5FSmlDLEVBUUEsT0M0RElBLEdBQWVyRCxFQUFtQmMsVUFBVXNCLGFBQWF4QixLQUFLZixLQUFNcUIsRUFBTUMsRUFBU0MsR0RqRXZGLFNBQUF2QixLQUFBaUMsS0FBQVYsS0NtRU12QixLRGxFTnlGLFNBQUFqQyxFQUFBakMsVUFUQTRELEdBQUEzQixFQUFBbEMsUUM2RVFELEtBQU1BLEVEbEVka0UsY0FBQS9CLEVBQUFuQyxLQWRBWSxLQUFBakMsS0FBQWlDLEtBQUFWLElDb0ZXakIsRUFBUWtELEVBQWFpQyxZQUN4QnpGLEtBQUt5RixTQUFTakMsRUFBYWpDLFNBQVM2RCxTQUFXNUIsRUFBYWlDLFdEckVwRWpDLEdDMkVTckQsR0FFTkYsR0FFSEEsRUFBT3lGLGFBQWV2RixFQUVmRiIsImZpbGUiOiJ0by1qc29uLndlYi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBUb0pzb25cclxuICBjb25zdHJ1Y3RvcjogKEBkYXRhLCBvcHRpb25zKSAtPlxyXG4gICAgaWYgQCBpbnN0YW5jZW9mIFRvSnNvblxyXG4gICAgICAjIENhbGxlZCBhcyBjb25zdHJ1Y3RvclxyXG4gICAgICBpZiBvcHRpb25zP1xyXG4gICAgICAgIEBkYXRhS2V5ID0gb3B0aW9ucy5kYXRhS2V5XHJcbiAgICAgICAgQGpzb25LZXkgPSBvcHRpb25zLmpzb25LZXlcclxuICAgICAgICBAcGFyZW50Q29udGV4dCA9IG9wdGlvbnMucGFyZW50Q29udGV4dFxyXG4gICAgZWxzZVxyXG4gICAgICAjIENhbGxlZCBhcyBmdW5jdGlvblxyXG4gICAgICByZXR1cm4gKG5ldyBUb0pzb24oQGRhdGEsIG9wdGlvbnMpKS5hcHBseSgpXHJcblxyXG4gIGNoaWxkQ29udGV4dENsYXNzOiBAXHJcblxyXG4gICMgQ29udmVydHMgQGRhdGEgaW50byBqc29uIHdoaWxzdCBhcHBseWluZyBmaWx0ZXJzIGFuZCBjb252ZXJzaW9uc1xyXG4gIGFwcGx5OiAoZXhjbHVkZUN1c3RvbVRvSnNvbikgLT5cclxuICAgICMgZXhjbHVkZSBiZWZvcmUgZG9pbmcgYW55dGhpbmc/XHJcbiAgICBpZiBAX2V4Y2x1ZGUoKVxyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkXHJcblxyXG4gICAgIyBjb252ZXJ0IHRoZSBpbmNvbWluZyBkYXRhIChjb250ZXh0LmRhdGEpXHJcbiAgICBAX2NvbnZlcnREYXRhKClcclxuXHJcbiAgICAjIGV4Y2x1ZGUgYmFzZWQgb24gdGhlIGNvbnZlcnRlZCBkYXRhXHJcbiAgICBpZiBAX2V4Y2x1ZGVEYXRhKClcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG5cclxuICAgICMgY29udmVydCB0aGUgaW5jb21pbmcgZGF0YSAoY29udGV4dC5kYXRhKSBpbnRvIG91dGdvaW5nIGRhdGEgKGNvbnRleHQuanNvbilcclxuICAgIEBfdG9Kc29uKGV4Y2x1ZGVDdXN0b21Ub0pzb24pXHJcblxyXG4gICAgIyBleGNsdWRlIGJhc2VkIG9uIG91dGdvaW5nIGRhdGE/XHJcbiAgICBpZiBAX2V4Y2x1ZGVKc29uKClcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG5cclxuICAgICMgcmV0dXJuIHRoZSBvdXRnb2luZyBkYXRhIChjb250ZXh0Lmpzb24pXHJcbiAgICByZXR1cm4gQGpzb25cclxuXHJcbiAgIyBDb252ZXJ0cyBAZGF0YSBpbnRvIGpzb25cclxuICBfdG9Kc29uOiAoZXhjbHVkZUN1c3RvbVRvSnNvbikgLT5cclxuICAgIGlmIG5vdCBleGNsdWRlQ3VzdG9tVG9Kc29uIGFuZCBAZGF0YT8udG9Kc29uQ29udGV4dD8gYW5kIHR5cGVvZiBAZGF0YS50b0pzb25Db250ZXh0ID09ICdmdW5jdGlvbidcclxuICAgICAgQGRhdGEudG9Kc29uQ29udGV4dChAKS5hcHBseSh0cnVlKVxyXG4gICAgZWxzZSBpZiBub3QgZXhjbHVkZUN1c3RvbVRvSnNvbiBhbmQgQGRhdGE/LnRvSlNPTj8gYW5kIHR5cGVvZiBAZGF0YS50b0pTT04gPT0gJ2Z1bmN0aW9uJ1xyXG4gICAgICBAanNvbiA9IEBkYXRhLnRvSlNPTigpXHJcbiAgICBlbHNlXHJcbiAgICAgIEBqc29uID0gQF9nZXRFbnVtZXJhdG9yKCkoQF90b0pzb25OYW1lZC5iaW5kKEApKVxyXG4gICAgcmV0dXJuXHJcblxyXG4gICMgUmV0dXJucyBhbiBlbnVtZXJhdG9yIHdoaWNoIGl0ZXJhdGVzIG92ZXIgQGRhdGEgYXMgYW4gYXJyYXksIHJldHVybmluZyB0aGUgcmVzdWx0aW5nIGpzb25cclxuICBfZ2V0RW51bWVyYXRvckFycmF5OiAoKSAtPlxyXG4gICAgcmV0dXJuIChjYikgPT5cclxuICAgICAgQGpzb24gPSBbXVxyXG4gICAgICBmb3IgZWxlbWVudCwgaWVsZW1lbnQgaW4gQGRhdGFcclxuICAgICAgICBjYihlbGVtZW50LCBpZWxlbWVudCwgQF9nZXRKc29uSW5kZXgoaWVsZW1lbnQpKVxyXG4gICAgICByZXR1cm4gQGpzb25cclxuXHJcbiAgIyBSZXR1cm5zIGFuIGVudW1lcmF0b3Igd2hpY2ggaXRlcmF0ZXMgb3ZlciBAZGF0YSBhcyBhbiBvYmplY3QsIHJldHVybmluZyB0aGUgcmVzdWx0aW5nIGpzb25cclxuICBfZ2V0RW51bWVyYXRvck9iamVjdDogKCkgLT5cclxuICAgIHJldHVybiAoY2IpID0+XHJcbiAgICAgIEBqc29uID0ge31cclxuICAgICAgZm9yIG93biBrZXksIHZhbCBvZiBAZGF0YVxyXG4gICAgICAgIGNiKHZhbCwga2V5LCBAX2dldEpzb25LZXkoa2V5KSlcclxuICAgICAgcmV0dXJuIEBqc29uXHJcblxyXG4gICMgUmV0dXJucyBhbiBlbnVtZXJhdG9yIHdoaWNoIHNpbXBseSByZXR1cm5zIEBkYXRhXHJcbiAgX2dldEVudW1lcmF0b3JWYWx1ZTogKCkgLT5cclxuICAgIHJldHVybiAoKSA9PlxyXG4gICAgICBAanNvbiA9IEBkYXRhXHJcbiAgICAgIHJldHVybiBAanNvblxyXG5cclxuICAjIFJldHVybnMgYW4gZW51bWVyYXRvciB3aGljaCBlbnVtZXJhdGVzIG92ZXIgZGF0YSwgcmV0dXJuaW5nIHRoZSByZXN1bHRpbmcganNvblxyXG4gIF9nZXRFbnVtZXJhdG9yOiAoKSAtPlxyXG4gICAgaWYgQXJyYXkuaXNBcnJheShAZGF0YSlcclxuICAgICAgcmV0dXJuIEBfZ2V0RW51bWVyYXRvckFycmF5KClcclxuICAgIGVsc2UgaWYgdHlwZW9mIEBkYXRhID09ICdvYmplY3QnIGFuZCBAZGF0YSAhPSBudWxsXHJcbiAgICAgIHJldHVybiBAX2dldEVudW1lcmF0b3JPYmplY3QoKVxyXG4gICAgZWxzZVxyXG4gICAgICByZXR1cm4gQF9nZXRFbnVtZXJhdG9yVmFsdWUoKVxyXG5cclxuICAjI1xyXG4gICMgU3RhbmRhcmQgY2FsbGJhY2sgdXNlZCBpbiBlbnVtZXJhdG9ycy5cclxuICAjIEBwYXJhbSBkYXRhIC0gZGF0YSB0byBiZSBjb252ZXJ0ZWRcclxuICAjIEBwYXJhbSBkYXRhS2V5IHtzdHJpbmd8aW50fSAtIGtleS9pbmRleCBpbnRvIHRoZSBwYXJlbnQgc291cmNlIGRhdGEgYXMgZGV0ZXJtaW5lZCBieSB0aGUgZW51bWVyYXRvclxyXG4gICMgQHBhcmFtIGpzb25LZXkge3N0cmluZ3xpbnR9IC0ga2V5L2luZGV4IGludG8gdGhlIGpzb24gdGFyZ2V0IGRhdGEgYXMgZGV0ZXJtaW5lZCBieSB0aGUgZW51bWVyYXRvclxyXG4gICMgQHJldHVybiB7dG9Kc29ufSBjaGlsZCBjb250ZXh0XHJcbiAgX3RvSnNvbk5hbWVkOiAoZGF0YSwgZGF0YUtleSwganNvbktleSkgLT5cclxuICAgIGNoaWxkQ29udGV4dCA9IEBfY3JlYXRlQ2hpbGRDb250ZXh0KGRhdGEsIGRhdGFLZXksIGpzb25LZXkpXHJcblxyXG4gICAganNvbiA9IGNoaWxkQ29udGV4dC5hcHBseSgpXHJcblxyXG4gICAgaWYganNvbiAhPSB1bmRlZmluZWRcclxuICAgICAgQGpzb25banNvbktleV0gPSBqc29uXHJcblxyXG4gICAgcmV0dXJuIGNoaWxkQ29udGV4dFxyXG5cclxuICAjIHJldHVybnMgYSBuZXcgY29udGV4dCBmb3IgdXNlIHdpdGggY2hpbGQgZGF0YVxyXG4gICMgYXJndW1lbnRzIGFyZSB0aGUgc2FtZSBhcyB0aG9zZSBnaXZlbiB0byBAX3RvSnNvbk5hbWVkXHJcbiAgX2NyZWF0ZUNoaWxkQ29udGV4dDogKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpIC0+XHJcbiAgICByZXR1cm4gbmV3IEBjaGlsZENvbnRleHRDbGFzcyhcclxuICAgICAgZGF0YSxcclxuICAgICAge1xyXG4gICAgICAgIGRhdGFLZXk6IGRhdGFLZXlcclxuICAgICAgICBqc29uS2V5OiBqc29uS2V5XHJcbiAgICAgICAgcGFyZW50Q29udGV4dDogQFxyXG4gICAgICB9XHJcbiAgICApXHJcblxyXG4gICMgVXRpbGl0eSBmdW5jdGlvbiBmb3Igb3ZlcnJpZGluZyBjaGlsZCBjb250ZXh0IG1ldGhvZHNcclxuICAjIFVzZWZ1bCBmb3IgYXBwbHlpbmcgdmFyaW91cyBmaWx0ZXJzIGV0YyBmb3IgdGhlIGN1cnJlbnQgY29udGV4dFxyXG4gIGFkanVzdENvbnRleHQ6IChvdmVycmlkZXMsIHN0aWNreSkgLT5cclxuICAgIGZvciBvd24ga2V5LCB2YWx1ZSBvZiBvdmVycmlkZXNcclxuICAgICAgQFtrZXldID0gdmFsdWVcclxuXHJcbiAgICBpZiBzdGlja3lcclxuICAgICAgQGFkanVzdENoaWxkQ29udGV4dHMob3ZlcnJpZGVzLCBzdGlja3kpXHJcbiAgICByZXR1cm4gQFxyXG5cclxuICAjIFV0aWxpdHkgZnVuY3Rpb24gZm9yIG92ZXJyaWRpbmcgY2hpbGQgY29udGV4dCBtZXRob2RzXHJcbiAgIyBVc2VmdWwgZm9yIGFwcGx5aW5nIHZhcmlvdXMgZmlsdGVycyBldGMgZm9yIG9ubHkgdGhlIGltbWVkaWF0ZSBjaGlsZCBjbGFzc2VzXHJcbiAgIyBAcGFyYW0ge0Jvb2xlYW59IHN0aWNreSAtIElmIFRydWUsIGFsbCBmdXR1cmUgZ2VuZXJhdGlvbnMgd2lsbCBiZSBvdmVycmlkZGVuXHJcbiAgYWRqdXN0Q2hpbGRDb250ZXh0czogKG92ZXJyaWRlcywgc3RpY2t5KSAtPlxyXG4gICAgQGNoaWxkQ29udGV4dENsYXNzID0gY2xhc3MgZXh0ZW5kcyBAY2hpbGRDb250ZXh0Q2xhc3NcclxuICAgIGZvciBvd24ga2V5LCB2YWx1ZSBvZiBvdmVycmlkZXNcclxuICAgICAgQGNoaWxkQ29udGV4dENsYXNzLnByb3RvdHlwZVtrZXldID0gdmFsdWVcclxuICAgIGlmIHN0aWNreVxyXG4gICAgICBAY2hpbGRDb250ZXh0Q2xhc3MucHJvdG90eXBlLmNoaWxkQ29udGV4dENsYXNzID0gQGNoaWxkQ29udGV4dENsYXNzXHJcbiAgICByZXR1cm4gQFxyXG5cclxuICAjIHV0aWxpdHkgZnVuY3Rpb24gZm9yIGNoYWluaW5nIHN1cGVyIG1ldGhvZHNcclxuICBfc3VwZXI6IChuYW1lKSAtPlxyXG4gICAgY3VycmVudCA9IEBbbmFtZV1cclxuICAgIGNscyA9IEBjb25zdHJ1Y3RvclxyXG4gICAgd2hpbGUgY2xzPyBhbmQgY2xzLnByb3RvdHlwZVtuYW1lXSA9PSBjdXJyZW50XHJcbiAgICAgIGNscyA9IGNscy5fX3N1cGVyX18uY29uc3RydWN0b3JcclxuICAgIHJldHVybiBjbHMucHJvdG90eXBlW25hbWVdXHJcblxyXG4gIF9jYWxsU3VwZXI6IChuYW1lLCBhcmdzLi4uKSAtPlxyXG4gICAgQF9zdXBlcihuYW1lKS5hcHBseShALCBhcmdzKVxyXG5cclxuICAjIFJldHVybnMgdGhlIGtleSB0byB1c2UgZm9yIHRoZSBqc29uIG91dHB1dFxyXG4gIF9nZXRKc29uS2V5OiAoZGF0YUtleSkgLT5cclxuICAgIGRhdGFLZXlcclxuXHJcbiAgIyBSZXR1cm5zIHRoZSBrZXkgdG8gdXNlIGZvciB0aGUganNvbiBvdXRwdXRcclxuICBfZ2V0SnNvbkluZGV4OiAoZGF0YUluZGV4KSAtPlxyXG4gICAgQGpzb24ubGVuZ3RoXHJcblxyXG4gICMgZXhjbHVkZSBiZWZvcmUgZG9pbmcgYW55dGhpbmc/XHJcbiAgX2V4Y2x1ZGU6ICgpIC0+XHJcbiAgICBmYWxzZVxyXG5cclxuICAjIGNvbnZlcnQgdGhlIGluY29taW5nIGRhdGFcclxuICBfY29udmVydERhdGE6ICgpIC0+XHJcbiAgICByZXR1cm5cclxuXHJcbiAgIyBleGNsdWRlIGJhc2VkIG9uIHRoZSBjb252ZXJ0ZWQgZGF0YVxyXG4gIF9leGNsdWRlRGF0YTogKCkgLT5cclxuICAgIGZhbHNlXHJcblxyXG4gICMgZXhjbHVkZSBiYXNlZCBvbiBvdXRnb2luZyBkYXRhP1xyXG4gIF9leGNsdWRlSnNvbjogKCkgLT5cclxuICAgIGZhbHNlXHJcblxyXG4gICMgcmV0dXJuIGRhdGEgcGF0aCBmb3IgdGhpcyBjb250ZXh0XHJcbiAgZGF0YVBhdGg6ICgpIC0+XHJcbiAgICBwYXRoID0gW11cclxuICAgIG5vZGUgPSBAXHJcbiAgICB3aGlsZSBub2RlP1xyXG4gICAgICBpZiBub2RlLmRhdGFLZXk/XHJcbiAgICAgICAgcGF0aC51bnNoaWZ0KG5vZGUuZGF0YUtleSlcclxuICAgICAgbm9kZSA9IG5vZGUucGFyZW50Q29udGV4dFxyXG4gICAgcmV0dXJuIHBhdGhcclxuXHJcbiAgIyByZXR1cm4ganNvbiBwYXRoIGZvciB0aGlzIGNvbnRleHRcclxuICBqc29uUGF0aDogKCkgLT5cclxuICAgIHBhdGggPSBbXVxyXG4gICAgbm9kZSA9IEBcclxuICAgIHdoaWxlIG5vZGU/XHJcbiAgICAgIGlmIG5vZGUuanNvbktleT9cclxuICAgICAgICBwYXRoLnVuc2hpZnQobm9kZS5qc29uS2V5KVxyXG4gICAgICBub2RlID0gbm9kZS5wYXJlbnRDb250ZXh0XHJcbiAgICByZXR1cm4gcGF0aFxyXG5cclxuY2xhc3MgVG9Kc29uV2l0aFBhdGhNYXAgZXh0ZW5kcyBUb0pzb25cclxuICBjb25zdHJ1Y3RvcjogKGRhdGEsIG9wdGlvbnMpIC0+XHJcbiAgICBzdXBlcihkYXRhLCBvcHRpb25zKVxyXG5cclxuICAgIEBwYXRoTWFwID0gQHBhcmVudENvbnRleHQ/LnBhdGhNYXAgPyB7fVxyXG5cclxuICBjaGlsZENvbnRleHRDbGFzczogQFxyXG5cclxuICBfdG9Kc29uTmFtZWQ6IChkYXRhLCBkYXRhS2V5LCBqc29uS2V5KSAtPlxyXG4gICAgY2hpbGRDb250ZXh0ID0gc3VwZXIoZGF0YSwgZGF0YUtleSwganNvbktleSlcclxuXHJcbiAgICBpZiBAanNvbltqc29uS2V5XSAhPSB1bmRlZmluZWRcclxuICAgICAgQHBhdGhNYXBbY2hpbGRDb250ZXh0Lmpzb25QYXRoKCkuam9pbignLycpXSA9IGNoaWxkQ29udGV4dC5kYXRhUGF0aCgpLmpvaW4oJy8nKVxyXG5cclxuICAgIHJldHVybiBjaGlsZENvbnRleHRcclxuXHJcblRvSnNvbi5XaXRoUGF0aE1hcCA9IFRvSnNvbldpdGhQYXRoTWFwXHJcblxyXG5pc0VtcHR5ID0gKG9iaikgLT5cclxuICBmb3Igb3duIGtleSBvZiBvYmpcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIHJldHVybiB0cnVlXHJcblxyXG5jbGFzcyBUb0pzb25XaXRoUGF0aFRyZWUgZXh0ZW5kcyBUb0pzb25cclxuICBjb25zdHJ1Y3RvcjogKGRhdGEsIG9wdGlvbnMpIC0+XHJcbiAgICBzdXBlcihkYXRhLCBvcHRpb25zKVxyXG5cclxuICAgIEBwYXRoVHJlZSA9IHt9XHJcblxyXG4gIGNoaWxkQ29udGV4dENsYXNzOiBAXHJcblxyXG4gIF90b0pzb25OYW1lZDogKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpIC0+XHJcbiAgICBjaGlsZENvbnRleHQgPSBzdXBlcihkYXRhLCBkYXRhS2V5LCBqc29uS2V5KVxyXG5cclxuICAgIGlmIEBqc29uW2pzb25LZXldICE9IHVuZGVmaW5lZFxyXG4gICAgICBpZiBub3QgaXNFbXB0eShjaGlsZENvbnRleHQucGF0aFRyZWUpXHJcbiAgICAgICAgQHBhdGhUcmVlW2NoaWxkQ29udGV4dC5qc29uS2V5XSA9IHtcclxuICAgICAgICAgIGlkOiBjaGlsZENvbnRleHQuZGF0YUtleSxcclxuICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZENvbnRleHQucGF0aFRyZWVcclxuICAgICAgICB9XHJcbiAgICAgIGVsc2VcclxuICAgICAgICBAcGF0aFRyZWVbY2hpbGRDb250ZXh0Lmpzb25LZXldID0ge1xyXG4gICAgICAgICAgaWQ6IGNoaWxkQ29udGV4dC5kYXRhS2V5XHJcbiAgICAgICAgfVxyXG5cclxuICAgIHJldHVyblxyXG5cclxuVG9Kc29uLldpdGhQYXRoVHJlZSA9IFRvSnNvbldpdGhQYXRoVHJlZVxyXG5cclxuY2xhc3MgVG9Kc29uV2l0aERhdGFNYXAgZXh0ZW5kcyBUb0pzb25cclxuICBjb25zdHJ1Y3RvcjogKGRhdGEsIG9wdGlvbnMpIC0+XHJcbiAgICBzdXBlcihkYXRhLCBvcHRpb25zKVxyXG5cclxuICAgIEBkYXRhTWFwID0gQHBhcmVudENvbnRleHQ/LmRhdGFNYXAgPyB7fVxyXG5cclxuICBjaGlsZENvbnRleHRDbGFzczogQFxyXG5cclxuICBfdG9Kc29uTmFtZWQ6IChkYXRhLCBkYXRhS2V5LCBqc29uS2V5KSAtPlxyXG4gICAgY2hpbGRDb250ZXh0ID0gc3VwZXIoZGF0YSwgZGF0YUtleSwganNvbktleSlcclxuXHJcbiAgICBpZiBAanNvbltqc29uS2V5XSAhPSB1bmRlZmluZWRcclxuICAgICAgQGRhdGFNYXBbY2hpbGRDb250ZXh0Lmpzb25QYXRoKCkuam9pbignLycpXSA9IHtcclxuICAgICAgICBkYXRhUGF0aDogY2hpbGRDb250ZXh0LmRhdGFQYXRoKCkuam9pbignLycpXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICAgIGNvbnZlcnRlZERhdGE6IGNoaWxkQ29udGV4dC5kYXRhXHJcbiAgICAgICAganNvbjogQGpzb25banNvbktleV1cclxuICAgICAgfVxyXG5cclxuICAgIHJldHVybiBjaGlsZENvbnRleHRcclxuXHJcblRvSnNvbi5XaXRoRGF0YU1hcCA9IFRvSnNvbldpdGhEYXRhTWFwXHJcbmNsYXNzIFRvSnNvbldpdGhEYXRhVHJlZSBleHRlbmRzIFRvSnNvblxyXG4gIGNvbnN0cnVjdG9yOiAoZGF0YSwgb3B0aW9ucykgLT5cclxuICAgIHN1cGVyKGRhdGEsIG9wdGlvbnMpXHJcblxyXG4gICAgQGRhdGFUcmVlID0ge31cclxuXHJcbiAgY2hpbGRDb250ZXh0Q2xhc3M6IEBcclxuXHJcbiAgX3RvSnNvbk5hbWVkOiAoZGF0YSwgZGF0YUtleSwganNvbktleSkgLT5cclxuICAgIGNoaWxkQ29udGV4dCA9IHN1cGVyKGRhdGEsIGRhdGFLZXksIGpzb25LZXkpXHJcblxyXG4gICAgaWYgQGpzb25banNvbktleV0gIT0gdW5kZWZpbmVkXHJcbiAgICAgIEBkYXRhVHJlZVtjaGlsZENvbnRleHQuanNvbktleV0gPSB7XHJcbiAgICAgICAgaWQ6IGNoaWxkQ29udGV4dC5kYXRhS2V5XHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICAgIGNvbnZlcnRlZERhdGE6IGNoaWxkQ29udGV4dC5kYXRhXHJcbiAgICAgICAganNvbjogQGpzb25banNvbktleV1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgbm90IGlzRW1wdHkoY2hpbGRDb250ZXh0LmRhdGFUcmVlKVxyXG4gICAgICAgIEBkYXRhVHJlZVtjaGlsZENvbnRleHQuanNvbktleV0uY2hpbGRyZW4gPSBjaGlsZENvbnRleHQuZGF0YVRyZWVcclxuXHJcbiAgICByZXR1cm4gY2hpbGRDb250ZXh0XHJcblxyXG5Ub0pzb24uV2l0aERhdGFUcmVlID0gVG9Kc29uV2l0aERhdGFUcmVlXHJcbiIsbnVsbF0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9